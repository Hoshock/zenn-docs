---
title: "SQS ã¨ Lambda ã®ã‚„ã‚„ã“ã—ã„è¨­å®šã®æ•´ç†"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws"]
published: true
---

## ã¾ã¨ã‚

- Lambda å˜ä½“ã§åŒæ™‚å®Ÿè¡Œæ•°ã‚’åˆ¶å¾¡ã—ãŸã„
  - `AWS::Serverless::Function Properties.ReservedConcurrentExecutions`
- SQS -> Lambda ã«ãŠã‘ã‚‹ Lambda ã®èµ·å‹•æ¡ä»¶ã‚’åˆ¶å¾¡ã—ãŸã„
  - Lambda ã®åŒæ™‚å®Ÿè¡Œæ•°
    - `AWS::Serverless::Function Events.[SQS].Properties.ScalingConfig.MaximumConcurrency`
    - `AWS::Serverless::Function Properties.ReservedConcurrentExecutions` ã§åˆ¶å¾¡ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æº¢ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã„ã¦ãƒªãƒˆãƒ©ã‚¤ãŒã‹ã‹ã‚Šã€ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ã®æã‚ŒãŒã‚ã‚‹
  - Lambda ãŒä¸€åº¦ã«å—ã‘å–ã‚‹ SQS ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã®ä¸Šé™
    - `AWS::Serverless::Function Events.[SQS].Properties.BatchSize` ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 10ï¼‰
  - Lambda ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹å¾…æ©Ÿæ™‚é–“ã®ä¸Šé™
    - `AWS::Serverless::Function Events.[SQS].Properties.MaximumBatchingWindowInSeconds` ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 0ï¼‰
    - `AWS::SQS::Queue Properties.ReceiveMessageWaitTimeSeconds` ã¨ã„ã† SQS å´ã§ã‚·ãƒ§ãƒ¼ãƒˆ/ãƒ­ãƒ³ã‚°ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹è¨­å®šã‚‚ã‚ã‚‹
      - `ReceiveMessageWaitTimeSeconds` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å€¤ã‚ˆã‚Šã€`MatximumBatchingWindowInSecounds` ã®å€¤ãŒå°ã•ã„å ´åˆã€
        `ReceiveMessageWaitTimeSeconds` ãŒå„ªå…ˆã•ã‚Œã‚‹æ¨¡æ§˜[^1]
- SQS -> Lambda ã‚’å®Œå…¨ã«ç›´åˆ—ã§èµ·å‹•ã—ãŸã„
  - æœ€æ–°ã®è¨­å®š
    - `AWS::SQS::Queue Properties.FifoQueue` ã‚’ true ã«è¨­å®š
    - `AWS::Serverless::Function Events.[SQS].Properties.ScalingConfig.MaximumConcurrency` ã‚’ 1 ã«è¨­å®š
    - `AWS::Serverless::Function Events.[SQS].Properties.BatchSize` ã‚’ 1 ã«è¨­å®š
  - ä»¥å‰ã¾ã§ã®è¨­å®š
    - `AWS::SQS::Queue Properties.FifoQueue` ã‚’ true ã«è¨­å®š
    - `AWS::Serverless::Function Properties.ReservedConcurrentExecutions` ã‚’ 1 ã«è¨­å®š
    - `AWS::Serverless::Function Events.[SQS].Properties.BatchSize` ã‚’ 1 ã«è¨­å®š
    - SQS ãŒ FIFO ã®å ´åˆã€ãªãœã‹ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æº¢ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã„ã¦ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ãŒèµ·ããªã„
      - ã—ã‹ã—ã€`MaximumConcurrency` ãŒå°å…¥ã•ã‚ŒãŸç¾åœ¨ã§ã¯æœ€æ–°ã®è¨­å®šã®ã»ã†ãŒã‚ˆã„ã¨æ€ã‚ã‚Œã‚‹

[^1] [batch window lower than 20s but lambda function is called in 20s interval (AWS re:Post)](https://repost.aws/questions/QU7nMv_AXbT-W_VcJ4t5VcRQ/batch-window-lower-than-20s-but-lambda-function-is-called-in-20s-interval)
